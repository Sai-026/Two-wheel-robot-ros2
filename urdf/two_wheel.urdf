<?xml version="1.0"?>
<robot name="two_wheel">
  
  <link name="base_link">
  </link>
  
  <link name="chassis_link">
    <inertial>
      <origin xyz="-3.5993E-05 4.3657E-08 -0.08462" rpy="0 0 0" />
      <mass value="6.8782" />
      <inertia
        ixx="0.032633" ixy="1.906E-08" ixz="-9.8071E-06"
        iyy="0.048016" iyz="2.4155E-08" izz="0.047837" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://two_wheel/meshes/chassis_link.STL" />
      </geometry>
      <material name="">
        <color rgba="0.79216 0.81961 0.93333 1" />
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://two_wheel/meshes/chassis_link.STL" />
      </geometry>
    </collision>
  </link>
  
  <joint name="chassis_joint" type="fixed">
    <parent link="base_link"/>
    <child link="chassis_link"/>
    <origin xyz="0 0 0" rpy="0 0 0"/>
  </joint>

  <link name="right_wheel_link">
    <inertial>
      <origin xyz="0 6.9389E-18 -0.015" rpy="0 0 0" />
      <mass value="0.11545" />
      <inertia
        ixx="4.4017E-05" ixy="-2.068E-22" ixz="-6.8001E-20"
        iyy="4.4017E-05" iyz="-4.1219E-21" izz="7.0715E-05" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://two_wheel/meshes/right_wheel_link.STL" />
      </geometry>
      <material name="">
        <color rgba="0.79216 0.81961 0.93333 1" />
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://two_wheel/meshes/right_wheel_link.STL" />
      </geometry>
    </collision>
  </link>
  
  <joint name="right_wheel_joint" type="continuous">
    <origin xyz="-0.063509 -0.12592 -0.1525" rpy="1.5708 0 0" />
    <parent link="chassis_link" />
    <child link="right_wheel_link" />
    <axis xyz="0 0 -1" />
    <dynamics damping="0.1" friction="0.1" />
  </joint>
  
  <link name="left_wheel_link">
    <inertial>
      <origin xyz="0 1.3878E-17 0.015" rpy="0 0 0" />
      <mass value="0.11545" />
      <inertia
        ixx="4.4017E-05" ixy="7.6191E-22" ixz="3.1198E-20"
        iyy="4.4017E-05" iyz="-1.6665E-22" izz="7.0715E-05" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://two_wheel/meshes/left_wheel_link.STL" />
      </geometry>
      <material name="">
        <color rgba="0.79216 0.81961 0.93333 1" />
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://two_wheel/meshes/left_wheel_link.STL" />
      </geometry>
    </collision>
  </link>
  
  <joint name="left_wheel_joint" type="continuous">
    <origin xyz="-0.063509 0.12592 -0.1525" rpy="1.5708 0 0" />
    <parent link="chassis_link" />
    <child link="left_wheel_link" />
    <axis xyz="0 0 -1" />
    <dynamics damping="0.1" friction="0.1" />
  </joint>
  
  <link name="lidar_link">
    <inertial>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <mass value="0.125" />
      <inertia
        ixx="0.001" ixy="0" ixz="0"
        iyy="0.001" iyz="0" izz="0.001" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://two_wheel/meshes/lidar_link.STL" />
      </geometry>
      <material name="">
        <color rgba="1 1 1 1" />
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://two_wheel/meshes/lidar_link.STL" />
      </geometry>
    </collision>
  </link>
  
  <joint name="lidar_joint" type="continuous">
    <origin xyz="0 0 0.024" rpy="0 0 0" />
    <parent link="chassis_link" />
    <child link="lidar_link" />
    <axis xyz="0 0 1" />
  </joint>

  <gazebo>
    <plugin name="differential_drive_controller" filename="libgazebo_ros_diff_drive.so">
      <update_rate>50</update_rate>
      <left_joint>left_wheel_joint</left_joint>
      <right_joint>right_wheel_joint</right_joint>
      <wheel_separation>0.22184</wheel_separation>
      <wheel_diameter>0.07</wheel_diameter>
      <max_wheel_torque>20</max_wheel_torque>
      <max_wheel_acceleration>1.0</max_wheel_acceleration>
      <publish_odom>true</publish_odom>
      <publish_odom_tf>true</publish_odom_tf>
      <publish_wheel_tf>false</publish_wheel_tf>
      <odometry_topic>odom</odometry_topic>
      <odometry_frame>odom</odometry_frame>
      <robot_base_frame>base_link</robot_base_frame>
    </plugin>
  </gazebo>

  <gazebo reference="chassis_link">
    <material>Gazebo/Blue</material>
    <mu1>0.2</mu1>
    <mu2>0.2</mu2>
  </gazebo>

  <gazebo reference="right_wheel_link">
    <material>Gazebo/Grey</material>
    <mu1>1.0</mu1>
    <mu2>1.0</mu2>
    <kp>1000000.0</kp>
    <kd>100.0</kd>
    <minDepth>0.001</minDepth>
    <maxVel>1.0</maxVel>
  </gazebo>

  <gazebo reference="left_wheel_link">
    <material>Gazebo/Grey</material>
    <mu1>1.0</mu1>
    <mu2>1.0</mu2>
    <kp>1000000.0</kp>
    <kd>100.0</kd>
    <minDepth>0.001</minDepth>
    <maxVel>1.0</maxVel>
  </gazebo>

  <gazebo reference="lidar_link">
    <material>Gazebo/White</material>
  </gazebo>

  <gazebo reference="lidar_link">
    <sensor type="ray" name="lidar_sensor">
      <pose>0 0 0 0 0 0</pose>
      <visualize>true</visualize>
      <update_rate>10</update_rate>
      <ray>
        <scan>
          <horizontal>
            <samples>360</samples>
            <resolution>1</resolution>
            <min_angle>-3.14159</min_angle>
            <max_angle>3.14159</max_angle>
          </horizontal>
        </scan>
        <range>
          <min>0.12</min>
          <max>10.0</max>
          <resolution>0.01</resolution>
        </range>
        <noise>
          <type>gaussian</type>
          <mean>0.0</mean>
          <stddev>0.01</stddev>
        </noise>
      </ray>
      <plugin name="gazebo_ros_lidar_controller" filename="libgazebo_ros_ray_sensor.so">
        <output_type>sensor_msgs/LaserScan</output_type>
        <frame_name>lidar_link</frame_name>
        <topic_name>/scan</topic_name>
      </plugin>
    </sensor>
  </gazebo>

</robot>
